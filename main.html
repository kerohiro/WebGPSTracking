<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>GPS Logger</title>
    </head>
    <body>
        <h1>GPS Logger</h1>
        <button onclick="startLogging()">Start Logging</button>
        <button onclick="stopLogging()">Stop Logging</button>
        <button onclick="downloadLog()">Download Log</button>
        <p id="status">Status: Not logging</p>

        <script>
            let watchId = null;
            let logs = [];

            // start logging
            function startLogging(){
                document.getElementById("status").innerText = "Status: Logging...";
                if (!navigator.geolocation) {
                    alert("Geolocation is not supported by this browser.");
                    return;
                }

                // get location every 10 seconds
                watchId = setInterval(() => {
                    navigator.geolocation.getCurrentPosition((pos) => {
                        if(pos && pos.coords){
                            const data = {
                                lat: pos.coords.latitude || 0,
                                lon: pos.coords.longitude || 0,
                                accuracy: pos.coords.accuracy || null,
                                time: new Date().toISOString()
                            };
                            logs.push(data);
                            console.log("Logged:", data);
                        }
                    }, 
                    (err) => console.error(err),
                    {
                        enableHighAccuracy: true, timeout: 10000, maximumAge:0
                    }
                );
                }, 1000);
            }

            // stop logging
            function stopLogging() {
                if(watchId){
                    clearInterval(watchId);
                    watchId = null;
                    document.getElementById("status").innerText = "Status: Not logging";
                );
                }, 1000);
            }

            // stop logging
            function stopLogging() {
                if(watchId){
                    clearInterval(watchId);
                    watchId = null;
                    document.getElementById("status").innerText = "Status: Not logging";
                }
            }

            // stop logging
            function stopLogging() {
                if(watchId){
                    clearInterval(watchId);
                    watchId = null;
                    document.getElementById("status").innerText = "Status: Not logging";
                }
            }

            // download logging data
            function downloadLog() {
                if(logs.length === 0) {
                    alert("No logs available to download.");
                    return;
                }

                let csv = "lat, lon, accuracy, time\n";
                logs.forEach(d => {
                    csv += `${d.lat}, ${d.lon}, ${d.accuracy}, ${d.time}\n`;
                });
                const blob = new Blob([csv], { type: "text/csv"});
                const url = URL.createObjectURL(blob);
                const a  = document.createElement("a");
                a.href = url;
                a.download = "gps_log.csv";
                a.click();
                URL.revokeObjectURL(url);
            }
        </script>
    </body>
</html>